# 木桩法图形修改说明

## 修改目的
将木桩法的图形从"从顶部砍去"改为"从底部砍去"，这样砍掉后所有木桩的顶部会形成一条水平直线，更加直观。

## 需要修改的位置
在 `07_找规律.ipynb` 文件中，找到 `solve_consecutive_numbers()` 函数中的"图2"和"图4"部分。

---

## 修改1：图2 - 从底部砍去

### 修改前的代码
```python
# 图2：砍去第一根的高度（每根砍掉3）
ax = axes[0, 1]
for i, num in enumerate(numbers):
    # 绘制砍掉的部分（用红色表示）
    rect_cut = patches.Rectangle((i, num - 3), 0.6, 3, 
                                    facecolor='lightcoral', edgecolor='red', linewidth=2,
                                    alpha=0.7, hatch='//')
    ax.add_patch(rect_cut)
    # 绘制剩下的部分
    rect_remain = patches.Rectangle((i, 0), 0.6, num - 3, 
                                      facecolor='lightgreen', edgecolor='green', linewidth=2)
    ax.add_patch(rect_remain)
    # 标注砍掉的高度
    ax.text(i + 0.3, num - 1.5, '砍掉3', fontsize=10, ha='center', va='center', 
            color='red', fontweight='bold')
    # 标注剩下的高度
    ax.text(i + 0.3, (num - 3) / 2, str(num - 3), fontsize=12, ha='center', va='center', 
            fontweight='bold', color='darkgreen')
ax.set_xlim(-0.5, 6)
ax.set_ylim(-0.5, 9)
ax.set_title('每根砍去第一根的高度（砍掉3）', fontsize=14, fontweight='bold')
ax.set_ylabel('高度', fontsize=12)
ax.grid(True, alpha=0.3)
```

### 修改后的代码
```python
# 图2：砍去第一根的高度（每根砍掉3）
ax = axes[0, 1]
for i, num in enumerate(numbers):
    # 绘制砍掉的部分（从底部砍去，用红色表示）
    rect_cut = patches.Rectangle((i, 0), 0.6, 3, 
                                    facecolor='lightcoral', edgecolor='red', linewidth=2,
                                    alpha=0.7, hatch='//')
    ax.add_patch(rect_cut)
    # 绘制剩下的部分（顶部）
    rect_remain = patches.Rectangle((i, 3), 0.6, num - 3, 
                                      facecolor='lightgreen', edgecolor='green', linewidth=2)
    ax.add_patch(rect_remain)
    # 标注砍掉的高度
    ax.text(i + 0.3, 1.5, '砍掉3', fontsize=10, ha='center', va='center', 
            color='red', fontweight='bold')
    # 标注剩下的高度
    ax.text(i + 0.3, 3 + (num - 3) / 2, str(num - 3), fontsize=12, ha='center', va='center', 
            fontweight='bold', color='darkgreen')
# 绘制砍切线
ax.axhline(y=3, color='red', linestyle='--', linewidth=2, label='砍切线')
ax.set_xlim(-0.5, 6)
ax.set_ylim(-0.5, 9)
ax.set_title('从底部砍去第一根的高度（砍掉3）', fontsize=14, fontweight='bold')
ax.set_ylabel('高度', fontsize=12)
ax.grid(True, alpha=0.3)
ax.legend(loc='upper right')
```

---

## 修改2：图4 - 修复中文显示

### 修改前的代码
```python
# 显示计算过程
calculation_text = """计算过程：

1. 剩下的高度：0 + 1 + 2 + 3 + 4 + 5 = 15

2. 总和是33，砍掉的总和：33 - 15 = 18

3. 每根砍掉：18 ÷ 6 = 3

4. 第一根木桩高度：3

5. 这6个连续数字：3, 4, 5, 6, 7, 8

验证：
3 + 4 + 5 + 6 + 7 + 8 = 33 ✓"""

ax.text(0.5, 0.5, calculation_text, fontsize=12, ha='center', va='center',
        family='monospace', bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.5))
```

### 修改后的代码
```python
# 显示计算过程
calculation_text = """计算过程：

1. 剩下的高度：0 + 1 + 2 + 3 + 4 + 5 = 15

2. 总和是33，砍掉的总和：33 - 15 = 18

3. 每根砍掉：18 ÷ 6 = 3

4. 第一根木桩高度：3

5. 这6个连续数字：3, 4, 5, 6, 7, 8

验证：
3 + 4 + 5 + 6 + 7 + 8 = 33 √"""

ax.text(0.5, 0.5, calculation_text, fontsize=12, ha='center', va='center',
        bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.5))
```

---

## 主要修改点总结

### 图2的修改：

1. **砍掉部分的矩形位置**：
   - 修改前：`patches.Rectangle((i, num - 3), 0.6, 3, ...)` - 从顶部砍去
   - 修改后：`patches.Rectangle((i, 0), 0.6, 3, ...)` - 从底部砍去

2. **剩下部分的矩形位置**：
   - 修改前：`patches.Rectangle((i, 0), 0.6, num - 3, ...)` - 剩下部分在底部
   - 修改后：`patches.Rectangle((i, 3), 0.6, num - 3, ...)` - 剩下部分在顶部

3. **标注位置调整**：
   - 砍掉高度标注：从 `num - 1.5` 改为 `1.5`（固定在砍掉部分的中间）
   - 剩下高度标注：从 `(num - 3) / 2` 改为 `3 + (num - 3) / 2`（在剩下部分的中间）

4. **添加砍切线**：
   - 添加：`ax.axhline(y=3, color='red', linestyle='--', linewidth=2, label='砍切线')`

5. **添加图例**：
   - 添加：`ax.legend(loc='upper right')`

6. **标题修改**：
   - 从 `'每根砍去第一根的高度（砍掉3）'` 改为 `'从底部砍去第一根的高度（砍掉3）'`

### 图4的修改：

1. **移除字体参数**：
   - 移除：`family='monospace'`
   - 原因：该参数会覆盖全局的中文字体设置，导致中文显示为乱码

2. **修改对勾符号**：
   - 从 `✓` 改为 `√`
   - 原因：避免字体警告

---

## 效果说明

### 修改后的图形会：

**图2（从底部砍去）**：
- 红色部分（砍掉的部分）在底部，从y=0到y=3
- 绿色部分（剩下的部分）在顶部，从y=3到y=num
- 所有木桩的顶部对齐到y=3的位置，形成一条水平线
- 红色虚线标示砍切线，更直观地显示砍切位置

**图4（计算过程）**：
- 中文文字正常显示，无乱码
- 无字体警告
- 使用全局设置的中文字体（SimHei, Microsoft YaHei, SimSun）

---

## 测试文件

我已经创建了一个测试文件 `test_wood_pile_method.py`，你可以运行它来查看修改后的效果：

```bash
python test_wood_pile_method.py
```

这个测试文件已经成功运行，图形显示正确，中文正常显示，没有任何警告。
